<?xml version="1.0" encoding="UTF-8"?>
<entitymodel xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="https://ofbiz.apache.org/dtds/entitymodel.xsd">
    <!-- ========================================================= -->
    <!-- ======================== Defaults ======================= -->
    <!-- ========================================================= -->
    <title>Entity of Banyan Component</title>
    <description>None</description>
    <copyright>https://github.com/yanghua/banyan</copyright>
    <version>0.1</version>
    
    <entity entity-name="App" package-name="org.ofbiz.banyan">
        <field name="appId" type="id-ne" />
        <field name="name" type="name" />
        <field name="creator" type="id-ne" />
        <field name="fromDate" type="date-time"/>
        <field name="thruDate" type="date-time"/>
        <prim-key field="appId" />
        <relation type="one" rel-entity-name="UserLogin" fk-name="fk_App_UserLogin">
            <key-map field-name="creator" rel-field-name="userLoginId"/>
        </relation>
        <relation type="many" rel-entity-name="Node" fk-name="fk">
            <key-map field-name="appId"/>
        </relation>
    </entity>

    <entity entity-name="Node" package-name="org.ofbiz.banyan" title="Node Entity">
        <field name="nodeId" type="id-ne" />
        <field name="secret" type="value" />
        <field name="name" type="name" />
        <field name="value" type="value" />
        <field name="parentId" type="id" />
        <field name="type" type="id" />
        <field name="routerType" type="value" />
        <field name="routingKey" type="value" />
        <field name="available" type="indicator" />
        <field name="isInner" type="indicator" />
        <field name="isVirtual" type="indicator" />
        <field name="communicateType" type="name" />
        <field name="creator" type="id-ne" />
        <field name="appId" type="id-ne" />
        <field name="rateLimit" type="short-varchar" />
        <field name="threshold" type="short-varchar" />
        <field name="msgBodySize" type="short-varchar" />
        <field name="ttl" type="short-varchar" />
        <field name="ttlPerMsg" type="short-varchar" />
        <field name="auditTypeCode" type="name" />
        <field name="canBroadcast" type="indicator" />
        <field name="fromDate" type="date-time" />
        <field name="thruDate" type="date-time" />
        <prim-key field="nodeId"/>
        <relation type="one" rel-entity-name="UserLogin" fk-name="fk_Node_UserLogin">
            <key-map field-name="creator" rel-field-name="userLoginId"/>
        </relation>
        <relation type="one" rel-entity-name="AuditType" fk-name="fk_Node_AuditType">
            <key-map field-name="auditTypeCode"/>
        </relation>
        <relation type="one" rel-entity-name="App" fk-name="fk_Node_App">
            <key-map field-name="appId"/>
        </relation>
    </entity>
    
    <entity entity-name="Sink" package-name="org.ofbiz.banyan" title="Sink Entity">
        <field name="sinkId" type="id-ne" />
        <field name="token" type="value" />
        <field name="flowFrom" type="id-ne" />
        <field name="fromCommunicateType" type="name" />
        <field name="flowTo" type="id-ne" />
        <field name="toCommunicateType" type="name" />
        <field name="enable" type="indicator" />
        <field name="creator" type="id-ne" />
        <field name="auditTypeCode" type="name" />
        <prim-key field="sinkId" />
        <relation type="one" rel-entity-name="UserLogin" fk-name="fk_Sink_UserLogin">
            <key-map field-name="creator" rel-field-name="userLoginId"/>
        </relation>
        <relation type="one" rel-entity-name="AuditType" fk-name="fk_Sink_AuditType">
            <key-map field-name="auditTypeCode"/>
        </relation>
        <relation type="one" rel-entity-name="Node" fk-name="fk_Sink_Node_flowFrom">
            <key-map field-name="flowFrom" rel-field-name="nodeId" />
        </relation>
        <relation type="one" rel-entity-name="Node" fk-name="fk_Sink_Node_flowTo">
            <key-map field-name="flowTo" rel-field-name="nodeId" />
        </relation>
    </entity>

    <view-entity entity-name="SinkAndNode" package-name="org.ofbiz.banyan" title="sink and node">
        <member-entity entity-alias="SNK" entity-name="Sink" />
        <member-entity entity-alias="NDE_1" entity-name="Node" />
        <member-entity entity-alias="NDE_2" entity-name="Node" />
        <alias-all entity-alias="SNK" />
        <alias name="flowFromNodeName" field="name" entity-alias="NDE_1" />
        <alias name="flowToNodeName" field="name" entity-alias="NDE_2" />
        <view-link entity-alias="SNK" rel-entity-alias="NDE_1">
            <key-map field-name="flowFrom" rel-field-name="nodeId" />
        </view-link>
        <view-link entity-alias="SNK" rel-entity-alias="NDE_2">
            <key-map field-name="flowTo" rel-field-name="nodeId" />
        </view-link>
    </view-entity>

    <entity entity-name="NodeAuditHistory" package-name="org.ofbiz.banyan" title="Node Audit Entity">
        <field name="nodeAuditId" type="id-ne" />
        <field name="nodeId" type="id-ne" />
        <field name="auditTypeCode" type="name" />
        <field name="auditor" type="id-ne" />
        <field name="fromDate" type="date-time"/>
        <field name="thruDate" type="date-time"/>
        <prim-key field="nodeAuditId" />
        <relation type="one" rel-entity-name="AuditType" fk-name="fk_NodeAuditHistory_AuditType">
            <key-map field-name="auditTypeCode"/>
        </relation>
        <relation type="one" rel-entity-name="Node" fk-name="fk_NodeAuditHistory_Node">
            <key-map field-name="nodeId" />
        </relation>
        <relation type="one" rel-entity-name="UserLogin" fk-name="fk_NodeAuditHistory_UserLogin">
            <key-map field-name="auditor" rel-field-name="userLoginId"/>
        </relation>
    </entity>

    <entity entity-name="SinkAuditHistory" package-name="org.ofbiz.banyan" title="Sink Audit Entity">
        <field name="sinkAuditId" type="id-ne" />
        <field name="sinkId" type="id-ne" />
        <field name="auditTypeCode" type="name" />
        <field name="auditor" type="id-ne" />
        <field name="fromDate" type="date-time"/>
        <field name="thruDate" type="date-time"/>
        <prim-key field="sinkAuditId" />
        <relation type="one" rel-entity-name="AuditType" fk-name="fk_SinkAuditHistory_AuditType">
            <key-map field-name="auditTypeCode"/>
        </relation>
        <relation type="one" rel-entity-name="Sink" fk-name="fk_SinkAuditHistory_Sink">
            <key-map field-name="sinkId"/>
        </relation>
        <relation type="one" rel-entity-name="UserLogin" fk-name="fk_SinkAuditHistory_UserLogin">
            <key-map field-name="auditor" rel-field-name="userLoginId"/>
        </relation>
    </entity>

    <entity entity-name="AuditType" package-name="org.ofbiz.banyan" title="Audit Type Entity">
        <field name="auditTypeCode" type="name" />
        <field name="auditTypeName" type="name" />
        <prim-key field="auditTypeCode" />
    </entity>

    <entity entity-name="Config" package-name="org.ofbiz.banyan" title="Config Entity">
        <field name="configId" type="id-ne" />
        <field name="itemKey" type="name" />
        <field name="itemValue" type="value" />
        <field name="type" type="value" />
        <prim-key field="configId" />
    </entity>

    <entity entity-name="QueueRateWarning" package-name="org.ofbiz.banyan" title="Queue Rate Warning">
        <field name="warningId" type="id-ne" />
        <field name="nodeId" type="id-ne" />
        <field name="rateLimit" type="value" />
        <field name="realRate" type="value" />
        <field name="fromDate" type="date-time" />
        <prim-key field="warningId" />
        <relation type="one" rel-entity-name="Node" fk-name="fk_QueueRateWarning_Node">
            <key-map field-name="nodeId" />
        </relation>
    </entity>

</entitymodel>